<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>How to scrape Google search results with Python | Crawlee for JavaScript · Build reliable crawlers. Fast.</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://crawlee.dev/blog/scrape-google-search><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true name=og:description content="Crawlee helps you build and maintain your crawlers. It's open source, but built by developers who scrape millions of pages every day for a living."><meta data-rh=true property=og:title content="How to scrape Google search results with Python | Crawlee for JavaScript · Build reliable crawlers. Fast."><meta data-rh=true name=description content="Learn how to scrape google search results using Crawlee for Python"><meta data-rh=true property=og:description content="Learn how to scrape google search results using Crawlee for Python"><meta data-rh=true property=og:image content=https://crawlee.dev/assets/images/google-search-a91bfdf17a4c2860798444b1be56f625.webp><meta data-rh=true name=twitter:image content=https://crawlee.dev/assets/images/google-search-a91bfdf17a4c2860798444b1be56f625.webp><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2024-12-02T00:00:00.000Z><meta data-rh=true property=article:author content=https://github.com/Mantisus><meta data-rh=true property=article:tag content=community><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://crawlee.dev/blog/scrape-google-search><link data-rh=true rel=alternate href=https://crawlee.dev/blog/scrape-google-search hreflang=en><link data-rh=true rel=alternate href=https://crawlee.dev/blog/scrape-google-search hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://crawlee.dev/blog/scrape-google-search","@type":"BlogPosting","author":{"@type":"Person","description":"Community Member of Crawlee and web scraping expert","image":"https://avatars.githubusercontent.com/u/34358312?v=4","name":"Max","url":"https://github.com/Mantisus"},"datePublished":"2024-12-02T00:00:00.000Z","description":"Learn how to scrape google search results using Crawlee for Python","headline":"How to scrape Google search results with Python","image":{"@id":"https://crawlee.dev/assets/images/google-search-a91bfdf17a4c2860798444b1be56f625.webp","@type":"ImageObject","caption":"title image for the blog post: How to scrape Google search results with Python","contentUrl":"https://crawlee.dev/assets/images/google-search-a91bfdf17a4c2860798444b1be56f625.webp","url":"https://crawlee.dev/assets/images/google-search-a91bfdf17a4c2860798444b1be56f625.webp"},"isPartOf":{"@id":"https://crawlee.dev/blog","@type":"Blog","name":"Crawlee Blog - learn how to build better scrapers"},"keywords":[],"mainEntityOfPage":"https://crawlee.dev/blog/scrape-google-search","name":"How to scrape Google search results with Python","url":"https://crawlee.dev/blog/scrape-google-search"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Crawlee for JavaScript · Build reliable crawlers. Fast. RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Crawlee for JavaScript · Build reliable crawlers. Fast. Atom Feed"><link rel=search type=application/opensearchdescription+xml title="Crawlee for JavaScript · Build reliable crawlers. Fast." href=/opensearch.xml><!-- Google Tag Manager --><script>!function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id="+r+("dataLayer"!=n?"&l="+n:""),g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer","GTM-5P7MCS7")</script><!-- End Google Tag Manager --><script>window.intercomSettings={api_base:"https://api-iam.intercom.io",app_id:"kod1r788"},function(){var t=window,e=t.Intercom;if("function"==typeof e)e("reattach_activator"),e("update",t.intercomSettings);else{var n=document,a=function(){a.c(arguments)};a.q=[],a.c=function(t){a.q.push(t)},t.Intercom=a;var i=function(){var t=n.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://widget.intercom.io/widget/kod1r788";var e=n.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)};"complete"===document.readyState?i():t.attachEvent?t.attachEvent("onload",i):t.addEventListener("load",i,!1)}}()</script><script src=/js/custom.js></script><link rel=stylesheet href=/assets/css/styles.0c563007.css><script src=/assets/js/runtime~main.0cc3aace.js defer></script><script src=/assets/js/main.d05cc3fe.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/crawlee-light.svg><link rel=preload as=image href=/img/crawlee-dark.svg><link rel=preload as=image href=/img/crawlee-javascript-light.svg><link rel=preload as=image href=/img/crawlee-javascript-dark.svg><link rel=preload as=image href=/img/crawlee-python-light.svg><link rel=preload as=image href=/img/crawlee-python-dark.svg><link rel=preload as=image href="https://avatars.githubusercontent.com/u/34358312?v=4"><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class=navbar__items><div class=navbarLogo__GY_><div class=logoWithArrows_cB9I><a class="logoImage_a28E sidebarLogo" href=/><img src=/img/crawlee-light.svg alt=Crawlee class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/crawlee-dark.svg alt=Crawlee class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16"><g stroke=#B2B8CC stroke-linecap=round stroke-linejoin=round><path d="M5.334 6 8 3.333 10.667 6M10.667 10 8 12.667 5.334 10"/></g></svg></div><div class=menuWrapper_zUZ_><div class=menu_CQ3p><a class=menuItem_QSny href=/js><img src=/img/crawlee-javascript-light.svg alt="Crawlee JavaScript" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/crawlee-javascript-dark.svg alt="Crawlee JavaScript" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><a href=https://crawlee.dev/python target=_self rel=dofollow class=menuItem_QSny><img src=/img/crawlee-python-light.svg alt="Crawlee Python" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/crawlee-python-dark.svg alt="Crawlee Python" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><a class=menuItem_QSny href=/><img src=/img/crawlee-light.svg alt=Crawlee class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/crawlee-dark.svg alt=Crawlee class="themedComponent_mlkZ themedComponent--dark_xIcU"><svg xmlns=http://www.w3.org/2000/svg width=17 height=16 fill=none viewBox="0 0 17 16"><path fill=#555D76 d="M14.742 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0l-3.25-3.25a.751.751 0 0 1 1.06-1.06l2.72 2.72 6.72-6.72a.75.75 0 0 1 1.06 0"/></svg></a></div></div></div><div class="navbarItems_fVuF navbarItems__leftMargin_FZoS"><a class="navbar__item navbar__link" href=/js>JavaScript</a><a href=https://crawlee.dev/python target=_self rel=dofollow class="navbar__item navbar__link">Python</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>Blog</a></div></div><div class="navbar__items navbar__items--right"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/superscraper-with-crawlee>Inside implementing SuperScraper with Crawlee</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/crawlee-for-python-v05>Crawlee for Python v0.5</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/scrape-crunchbase-python>How to scrape Crunchbase using Python in 2024 (Easy Guide)</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/scrape-google-maps>How to scrape Google Maps data using Python</a><li class=sidebarItem__DBe><a aria-current=page class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href=/blog/scrape-google-search>How to scrape Google search results with Python</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/graphql-persisted-query>Reverse engineering GraphQL persistedQuery extension</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/web-scraping-tips>12 tips on how to think like a web scraping expert</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/linkedin-job-scraper-python>How to create a LinkedIn job scraper in Python with Crawlee</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/scrape-using-jsdom>Optimizing web scraping: Scraping auth data using JSDOM</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/scraping-dynamic-websites-using-python>Web scraping of a dynamic website using Python with HTTP Client</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/infinite-scroll-using-python>How to scrape infinite scrolling webpages with Python</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/common-problems-in-web-scraping>Current problems and mistakes of web scraping in Python and tricks to solve them!</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/launching-crawlee-python>Announcing Crawlee for Python: Now you can use Python to build reliable web crawlers</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/proxy-management-in-crawlee>How Crawlee uses tiered proxies to avoid getting blocked</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/netflix-show-recommender>Building a Netflix show recommender using Crawlee and React</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/scrapy-vs-crawlee>Scrapy vs. Crawlee</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/how-to-scrape-amazon>How to scrape Amazon products</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/crawlee-blog-launch>Launching Crawlee Blog</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_xvU1>How to scrape Google search results with Python</h1><div class="container_iJTo margin-vert--md"><time datetime=2024-12-02T00:00:00.000Z>December 2, 2024</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href=https://github.com/Mantisus target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class=avatar__photo src="https://avatars.githubusercontent.com/u/34358312?v=4" alt=Max></a><div class=avatar__intro><div class=avatar__name><a href=https://github.com/Mantisus target=_blank rel="noopener noreferrer"><span>Max</span></a></div><small class=avatar__subtitle>Community Member of Crawlee and web scraping expert</small></div></div></div></div></header><div id=__blog-post-container class=markdown><p>Scraping <code>Google Search</code> delivers essential <code>SERP analysis</code>, SEO optimization, and data collection capabilities. Modern scraping tools make this process faster and more reliable.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>note</div><div class=admonitionContent_BuS1><p>One of our community members wrote this blog as a contribution to the Crawlee Blog. If you would like to contribute blogs like these to Crawlee Blog, please reach out to us on our <a href=https://apify.com/discord target=_blank rel="noopener noreferrer">discord channel</a>.</div></div>
<p>In this guide, we'll create a Google Search scraper using <a href=https://github.com/apify/crawlee-python target=_blank rel="noopener noreferrer"><code>Crawlee for Python</code></a> that can handle result ranking and pagination.</p>
<p>We'll create a scraper that:</p>
<ul>
<li>Extracts titles, URLs, and descriptions from search results</li>
<li>Handles multiple search queries</li>
<li>Tracks ranking positions</li>
<li>Processes multiple result pages</li>
<li>Saves data in a structured format</li>
</ul>
<p><img decoding=async loading=lazy alt="How to scrape Google search results with Python" src=/assets/images/google-search-a91bfdf17a4c2860798444b1be56f625.webp width=1152 height=649 class=img_ev3q></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=prerequisites>Prerequisites<a href=#prerequisites class=hash-link aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<ul>
<li>Python 3.7 or higher</li>
<li>Basic understanding of HTML and CSS selectors</li>
<li>Familiarity with web scraping concepts</li>
<li>Crawlee for Python v0.4.2 or higher</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=project-setup>Project setup<a href=#project-setup class=hash-link aria-label="Direct link to Project setup" title="Direct link to Project setup">​</a></h3>
<ol>
<li>
<p>Install Crawlee with required dependencies:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">pipx </span><span class="token function" style=color:#d73a49>install</span><span class="token plain"> crawlee</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">beautifulsoup,curl-impersonate</span><span class="token punctuation" style=color:#393A34>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p>Create a new project using Crawlee CLI:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">pipx run crawlee create crawlee-google-search</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p>When prompted, select <code>Beautifulsoup</code> as your template type.</p>
</li>
<li>
<p>Navigate to the project directory and complete installation:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token builtin class-name">cd</span><span class="token plain"> crawlee-google-search</span><br></span><span class=token-line style=color:#393A34><span class="token plain">poetry </span><span class="token function" style=color:#d73a49>install</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=development-of-the-google-search-scraper-in-python>Development of the Google Search scraper in Python<a href=#development-of-the-google-search-scraper-in-python class=hash-link aria-label="Direct link to Development of the Google Search scraper in Python" title="Direct link to Development of the Google Search scraper in Python">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=1-defining-data-for-extraction>1. Defining data for extraction<a href=#1-defining-data-for-extraction class=hash-link aria-label="Direct link to 1. Defining data for extraction" title="Direct link to 1. Defining data for extraction">​</a></h3>
<p>First, let's define our extraction scope. Google's search results now include maps, notable people, company details, videos, common questions, and many other elements. We'll focus on analyzing standard search results with rankings.</p>
<p>Here's what we'll be extracting:</p>
<p><img decoding=async loading=lazy alt="Search Example" src=/assets/images/search_example-53f4fdf556178b9478a8d4f3e3816669.webp width=1873 height=813 class=img_ev3q></p>
<p>Let's verify whether we can extract the necessary data from the page's HTML code, or if we need deeper analysis or <code>JS</code> rendering. Note that this verification is sensitive to HTML tags:</p>
<p><img decoding=async loading=lazy alt="Check Html" src=/assets/images/check_html-e243b1a0eff6d4404b9034863969bedc.webp width=1917 height=951 class=img_ev3q></p>
<p>Based on the data obtained from the page, all necessary information is present in the HTML code. Therefore, we can use <a href=https://www.crawlee.dev/python/docs/examples/beautifulsoup-crawler target=_blank rel="noopener noreferrer"><code>beautifulsoup_crawler</code></a>.</p>
<p>The fields we'll extract:</p>
<ul>
<li>Search result titles</li>
<li>URLs</li>
<li>Description text</li>
<li>Ranking positions</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=2-configure-the-crawler>2. Configure the crawler<a href=#2-configure-the-crawler class=hash-link aria-label="Direct link to 2. Configure the crawler" title="Direct link to 2. Configure the crawler">​</a></h3>
<p>First, let's create the crawler configuration.</p>
<p>We'll use <a href=https://www.crawlee.dev/python/api/class/CurlImpersonateHttpClient target=_blank rel="noopener noreferrer"><code>CurlImpersonateHttpClient</code></a> as our <code>http_client</code> with preset <code>headers</code> and <code>impersonate</code> relevant to the <a href=https://www.google.com/intl/en/chrome/ target=_blank rel="noopener noreferrer"><code>Chrome</code></a> browser.</p>
<p>We'll also configure <a href=https://www.crawlee.dev/python/api/class/ConcurrencySettings target=_blank rel="noopener noreferrer"><code>ConcurrencySettings</code></a> to control scraping aggressiveness. This is crucial to avoid getting blocked by Google.</p>
<p>If you need to extract data more intensively, consider setting up <a href=https://www.crawlee.dev/python/api/class/ProxyConfiguration target=_blank rel="noopener noreferrer"><code>ProxyConfiguration</code></a>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">beautifulsoup_crawler </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> BeautifulSoupCrawler</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">http_clients</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">curl_impersonate </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> CurlImpersonateHttpClient</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> ConcurrencySettings</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> HttpHeaders</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>None</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    concurrency_settings </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ConcurrencySettings</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">max_concurrency</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> max_tasks_per_minute</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>200</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    http_client </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> CurlImpersonateHttpClient</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">impersonate</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"chrome124"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                            headers</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">HttpHeaders</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"referer"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"https://www.google.com/"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                                     </span><span class="token string" style=color:#e3116c>"accept-language"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"en"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                                     </span><span class="token string" style=color:#e3116c>"accept-encoding"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"gzip, deflate, br, zstd"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                                     </span><span class="token string" style=color:#e3116c>"user-agent"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    crawler </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> BeautifulSoupCrawler</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        max_request_retries</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        concurrency_settings</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">concurrency_settings</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        http_client</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">http_client</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        max_requests_per_crawl</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>10</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        max_crawl_depth</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> crawler</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">run</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'https://www.google.com/search?q=Apify'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=3-implementing-data-extraction>3. Implementing data extraction<a href=#3-implementing-data-extraction class=hash-link aria-label="Direct link to 3. Implementing data extraction" title="Direct link to 3. Implementing data extraction">​</a></h3>
<p>First, let's analyze the HTML code of the elements we need to extract:</p>
<p><img decoding=async loading=lazy alt="Check Html" src=/assets/images/html_example-ccefa4ed63c38812ac5b8ca7b5122c8c.webp width=1916 height=931 class=img_ev3q></p>
<p>There's an obvious distinction between <em>readable</em> ID attributes and <em>generated</em> class names and other attributes. When creating selectors for data extraction, you should ignore any generated attributes. Even if you've read that Google has been using a particular generated tag for N years, you shouldn't rely on it - this reflects your experience in writing robust code.</p>
<p>Now that we understand the HTML structure, let's implement the extraction. As our crawler deals with only one type of page, we can use <code>router.default_handler</code> for processing it. Within the handler, we'll use <code>BeautifulSoup</code> to iterate through each search result, extracting data such as <code>title</code>, <code>url</code>, and <code>text_widget</code> while saving the results.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token decorator annotation punctuation" style=color:#393A34>@crawler</span><span class="token decorator annotation punctuation" style=color:#393A34>.</span><span class="token decorator annotation punctuation" style=color:#393A34>router</span><span class="token decorator annotation punctuation" style=color:#393A34>.</span><span class="token decorator annotation punctuation" style=color:#393A34>default_handler</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>default_handler</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> BeautifulSoupCrawlingContext</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>None</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token triple-quoted-string string" style=color:#e3116c>"""Default request handler."""</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">log</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">info</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f'Processing </span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">context</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>.</span><span class="token string-interpolation interpolation">request</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c> ...'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> item </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">soup</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"div#search div#rso div[data-hveid][lang]"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        data </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token string" style=color:#e3116c>'title'</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> item</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select_one</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"h3"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token string" style=color:#e3116c>"url"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> item</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select_one</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"a"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"href"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token string" style=color:#e3116c>"text_widget"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> item</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select_one</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"div[style*='line']"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">push_data</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">data</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=4-handling-pagination>4. Handling pagination<a href=#4-handling-pagination class=hash-link aria-label="Direct link to 4. Handling pagination" title="Direct link to 4. Handling pagination">​</a></h3>
<p>Since Google results depend on the IP geolocation of the search request, we can't rely on link text for pagination. We need to create a more sophisticated CSS selector that works regardless of geolocation and language settings.</p>
<p>The <code>max_crawl_depth</code> parameter controls how many pages our crawler should scan. Once we have our robust selector, we simply need to get the next page link and add it to the crawler's queue.</p>
<p>To write more efficient selectors, learn the basics of <a href=https://www.w3schools.com/cssref/css_selectors.php target=_blank rel="noopener noreferrer">CSS</a> and <a href=https://www.w3schools.com/xml/xpath_syntax.asp target=_blank rel="noopener noreferrer">XPath</a> syntax.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">enqueue_links</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">selector</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"div[role='navigation'] td[role='heading']:last-of-type > a"</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=5-exporting-data-to-csv-format>5. Exporting data to CSV format<a href=#5-exporting-data-to-csv-format class=hash-link aria-label="Direct link to 5. Exporting data to CSV format" title="Direct link to 5. Exporting data to CSV format">​</a></h3>
<p>Since we want to save all search result data in a convenient tabular format like CSV, we can simply add the export_data method call right after running the crawler:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> crawler</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">export_data_csv</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"google_search.csv"</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=6-finalizing-the-google-search-scraper>6. Finalizing the Google Search scraper<a href=#6-finalizing-the-google-search-scraper class=hash-link aria-label="Direct link to 6. Finalizing the Google Search scraper" title="Direct link to 6. Finalizing the Google Search scraper">​</a></h3>
<p>While our core crawler logic works, you might have noticed that our results currently lack ranking position information. To complete our scraper, we need to implement proper ranking position tracking by passing data between requests using <code>user_data</code> in <a href=https://www.crawlee.dev/python/api/class/Request target=_blank rel="noopener noreferrer"><code>Request</code></a>.</p>
<p>Let's modify the script to handle multiple queries and track ranking positions for search results analysis. We'll also set the crawling depth as a top-level variable. Let's move the <code>router.default_handler</code> to <code>routes.py</code> to match the project structure:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># crawlee-google-search.main</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">beautifulsoup_crawler </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> BeautifulSoupCrawler</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> BeautifulSoupCrawlingContext</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">http_clients</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">curl_impersonate </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> CurlImpersonateHttpClient</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> Request</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> ConcurrencySettings</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> HttpHeaders</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">routes </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> router</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">QUERIES </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"Apify"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Crawlee"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">CRAWL_DEPTH </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>None</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token triple-quoted-string string" style=color:#e3116c>"""The crawler entry point."""</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    concurrency_settings </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ConcurrencySettings</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">max_concurrency</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> max_tasks_per_minute</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>200</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    http_client </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> CurlImpersonateHttpClient</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">impersonate</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"chrome124"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                            headers</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">HttpHeaders</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"referer"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"https://www.google.com/"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                                     </span><span class="token string" style=color:#e3116c>"accept-language"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"en"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                                     </span><span class="token string" style=color:#e3116c>"accept-encoding"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"gzip, deflate, br, zstd"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                                     </span><span class="token string" style=color:#e3116c>"user-agent"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    crawler </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> BeautifulSoupCrawler</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        request_handler</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">router</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        max_request_retries</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        concurrency_settings</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">concurrency_settings</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        http_client</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">http_client</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        max_requests_per_crawl</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>100</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        max_crawl_depth</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">CRAWL_DEPTH</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    requests_lists </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">Request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">from_url</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f"https://www.google.com/search?q=</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">query</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> user_data </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"query"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> query</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> query </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> QUERIES</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> crawler</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">run</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">requests_lists</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> crawler</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">export_data_csv</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"google_ranked.csv"</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Let's also modify the handler to add <code>query</code> and <code>order_no</code> fields and basic error handling:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># crawlee-google-search.routes</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">beautifulsoup_crawler </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> BeautifulSoupCrawlingContext</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> crawlee</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">router </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> Router</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">router </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> Router</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">BeautifulSoupCrawlingContext</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token decorator annotation punctuation" style=color:#393A34>@router</span><span class="token decorator annotation punctuation" style=color:#393A34>.</span><span class="token decorator annotation punctuation" style=color:#393A34>default_handler</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>default_handler</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> BeautifulSoupCrawlingContext</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>None</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token triple-quoted-string string" style=color:#e3116c>"""Default request handler."""</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">log</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">info</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f'Processing </span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">context</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>.</span><span class="token string-interpolation interpolation">request</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>.</span><span class="token string-interpolation interpolation">url</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c> ...'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    order </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">user_data</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"last_order"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    query </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">user_data</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"query"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> item </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">soup</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"div#search div#rso div[data-hveid][lang]"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>try</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            data </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token string" style=color:#e3116c>"query"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> query</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token string" style=color:#e3116c>"order_no"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> order</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token string" style=color:#e3116c>'title'</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> item</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select_one</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"h3"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token string" style=color:#e3116c>"url"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> item</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select_one</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"a"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"href"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token string" style=color:#e3116c>"text_widget"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> item</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">select_one</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"div[style*='line']"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">push_data</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">data</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            order </span><span class="token operator" style=color:#393A34>+=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>except</span><span class="token plain"> AttributeError </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> e</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">log</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">warning</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f'Attribute error for query "</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">query</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>": </span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation builtin">str</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>(</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>)</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>except</span><span class="token plain"> Exception </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> e</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">log</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">error</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f'Unexpected error for query "</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">query</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>": </span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation builtin">str</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>(</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>)</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">enqueue_links</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">selector</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"div[role='navigation'] td[role='heading']:last-of-type > a"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                user_data</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"last_order"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> order</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"query"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> query</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>And we're done!</p>
<p>Our Google Search crawler is ready. Let's look at the results in the <code>google_ranked.csv</code> file:</p>
<p><img decoding=async loading=lazy alt="Results CSV" src=/assets/images/results-03c51354b4347837a24ec6977a442ce8.webp width=1319 height=588 class=img_ev3q></p>
<p>The code repository is available on <a href=https://github.com/Mantisus/crawlee-google-search target=_blank rel="noopener noreferrer"><code>GitHub</code></a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=scrape-google-search-results-with-apify>Scrape Google Search results with Apify<a href=#scrape-google-search-results-with-apify class=hash-link aria-label="Direct link to Scrape Google Search results with Apify" title="Direct link to Scrape Google Search results with Apify">​</a></h2>
<p>If you're working on a large-scale project requiring millions of data points, like the project featured in this <a href=https://backlinko.com/search-engine-ranking target=_blank rel="noopener noreferrer">article about Google ranking analysis</a> - you might need a ready-made solution.</p>
<p>Consider using <a href=https://www.apify.com/apify/google-search-scraper target=_blank rel="noopener noreferrer"><code>Google Search Results Scraper</code></a> by the Apify team.</p>
<p>It offers important features such as:</p>
<ul>
<li>Proxy support</li>
<li>Scalability for large-scale data extraction</li>
<li>Geolocation control</li>
<li>Integration with external services like <a href=https://zapier.com/ target=_blank rel="noopener noreferrer"><code>Zapier</code></a>, <a href=https://www.make.com/ target=_blank rel="noopener noreferrer"><code>Make</code></a>, <a href=https://airbyte.com/ target=_blank rel="noopener noreferrer"><code>Airbyte</code></a>, <a href=https://www.langchain.com/ target=_blank rel="noopener noreferrer"><code>LangChain</code></a> and others</li>
</ul>
<p>You can learn more in the Apify <a href=https://blog.apify.com/unofficial-google-search-api-from-apify-22a20537a951/ target=_blank rel="noopener noreferrer">blog</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=what-will-you-scrape>What will you scrape?<a href=#what-will-you-scrape class=hash-link aria-label="Direct link to What will you scrape?" title="Direct link to What will you scrape?">​</a></h2>
<p>In this blog, we've explored step-by-step how to create a Google Search crawler that collects ranking data. How you analyze this dataset is up to you!</p>
<p>As a reminder, you can find the full project code on <a href=https://github.com/Mantisus/crawlee-google-search target=_blank rel="noopener noreferrer"><code>GitHub</code></a>.</p>
<p>I'd like to think that in 5 years I'll need to write an article on "How to extract data from the best search engine for LLMs", but I suspect that in 5 years this article will still be relevant.</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a class="tag_zVej tagRegular_sFm0" href=/blog/tags/community>community</a></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/blog/scrape-google-maps><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>How to scrape Google Maps data using Python</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/blog/graphql-persisted-query><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>Reverse engineering GraphQL persistedQuery extension</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#prerequisites class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href=#project-setup class="table-of-contents__link toc-highlight">Project setup</a></ul><li><a href=#development-of-the-google-search-scraper-in-python class="table-of-contents__link toc-highlight">Development of the Google Search scraper in Python</a><ul><li><a href=#1-defining-data-for-extraction class="table-of-contents__link toc-highlight">1. Defining data for extraction</a><li><a href=#2-configure-the-crawler class="table-of-contents__link toc-highlight">2. Configure the crawler</a><li><a href=#3-implementing-data-extraction class="table-of-contents__link toc-highlight">3. Implementing data extraction</a><li><a href=#4-handling-pagination class="table-of-contents__link toc-highlight">4. Handling pagination</a><li><a href=#5-exporting-data-to-csv-format class="table-of-contents__link toc-highlight">5. Exporting data to CSV format</a><li><a href=#6-finalizing-the-google-search-scraper class="table-of-contents__link toc-highlight">6. Finalizing the Google Search scraper</a></ul><li><a href=#scrape-google-search-results-with-apify class="table-of-contents__link toc-highlight">Scrape Google Search results with Apify</a><li><a href=#what-will-you-scrape class="table-of-contents__link toc-highlight">What will you scrape?</a></ul></div></div></div></div></div><footer class="footer_J6tW light"><div class=footerTop_DGOU><div class=footerTopRow_xbYo><div class=footerTopRowLeft__jwX><a width=120 class=footerLogo_Jxa4 href=/><img src=/img/crawlee-light.svg alt="Docusaurus themed image" class="themedComponent_mlkZ themedComponent--light_NVdE" width=120><img src=/img/crawlee-dark.svg alt="Docusaurus themed image" class="themedComponent_mlkZ themedComponent--dark_xIcU" width=120></a><div class=toggle_MW0i><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type=button disabled title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><span><svg viewBox="0 0 13 12" fill=none xmlns=http://www.w3.org/2000/svg width=14 height=14 class=lightToggleIcon_SFTY><g clip-path=url(#clip0_833_8168)><path d="M6.59998 8.49999C7.98069 8.49999 9.09998 7.3807 9.09998 5.99999C9.09998 4.61928 7.98069 3.49999 6.59998 3.49999C5.21926 3.49999 4.09998 4.61928 4.09998 5.99999C4.09998 7.3807 5.21926 8.49999 6.59998 8.49999Z" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M6.59985 0.5V1.5" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M6.59985 10.5V11.5" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M2.7099 2.11L3.4199 2.82" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M9.77991 9.17999L10.4899 9.88999" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M1.09998 6H2.09998" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M11.0999 6H12.0999" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M2.7099 9.88999L3.4199 9.17999" stroke=currentColor stroke-linecap=round stroke-linejoin=round /><path d="M9.77991 2.82L10.4899 2.11" stroke=currentColor stroke-linecap=round stroke-linejoin=round /></g><defs><clipPath id=clip0_833_8168><rect width=12 height=12 fill=white transform=translate(0.599976) /></clipPath></defs></svg><svg viewBox="0 0 13 12" width=14 height=14 class=darkToggleIcon_ekgs><path d="M10.7001 6.39501C10.6215 7.24611 10.3021 8.05721 9.77927 8.7334C9.25646 9.40959 8.55189 9.92291 7.748 10.2133C6.9441 10.5036 6.07414 10.5591 5.2399 10.3731C4.40565 10.187 3.64164 9.76728 3.03726 9.1629C2.43287 8.55851 2.01312 7.7945 1.8271 6.96026C1.64108 6.12602 1.6965 5.25605 1.98688 4.45216C2.27725 3.64826 2.79056 2.94369 3.46675 2.42088C4.14294 1.89808 4.95404 1.57866 5.80515 1.50001C5.30685 2.17414 5.06707 3.00473 5.12941 3.84071C5.19175 4.6767 5.55208 5.46254 6.14485 6.05531C6.73762 6.64808 7.52346 7.0084 8.35944 7.07074C9.19542 7.13308 10.026 6.8933 10.7001 6.39501Z" stroke=currentColor fill=transparent stroke-linecap=round stroke-linejoin=round /></svg></span></button></div></div><div class=footerTopRowRight_dEd9><div><div class=footerTitle_tbhc>Docs</div><ul class="footerList_lK9E clean-list"><li><a class="footer__link-item footerLink_YJ8n" href=/docs/guides>Guides</a><li><a class="footer__link-item footerLink_YJ8n" href=/docs/examples>Examples</a><li><a class="footer__link-item footerLink_YJ8n" href=/api/core>API reference</a><li><a class="footer__link-item footerLink_YJ8n" href=/api/core/changelog>Changelog</a></ul></div><div><div class=footerTitle_tbhc>Product</div><ul class="footerList_lK9E clean-list"><li><a href=https://discord.com/invite/jyEM2PRvMU target=_blank rel="noopener noreferrer" class="footer__link-item footerLink_YJ8n">Discord<svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16" class=externalLinkIcon_gEsj><path fill=#fff fill-rule=evenodd d="M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V2.707L1.854 6.854a.5.5 0 1 1-.708-.708L5.293 2H2.5a.5.5 0 0 1-.5-.5" clip-rule=evenodd /></svg></a><li><a href=https://stackoverflow.com/questions/tagged/crawlee target=_blank rel="noopener noreferrer" class="footer__link-item footerLink_YJ8n">Stack Overflow<svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16" class=externalLinkIcon_gEsj><path fill=#fff fill-rule=evenodd d="M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V2.707L1.854 6.854a.5.5 0 1 1-.708-.708L5.293 2H2.5a.5.5 0 0 1-.5-.5" clip-rule=evenodd /></svg></a><li><a href=https://twitter.com/apify target=_blank rel="noopener noreferrer" class="footer__link-item footerLink_YJ8n">Twitter<svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16" class=externalLinkIcon_gEsj><path fill=#fff fill-rule=evenodd d="M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V2.707L1.854 6.854a.5.5 0 1 1-.708-.708L5.293 2H2.5a.5.5 0 0 1-.5-.5" clip-rule=evenodd /></svg></a><li><a href=https://www.youtube.com/apify target=_blank rel="noopener noreferrer" class="footer__link-item footerLink_YJ8n">YouTube<svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16" class=externalLinkIcon_gEsj><path fill=#fff fill-rule=evenodd d="M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V2.707L1.854 6.854a.5.5 0 1 1-.708-.708L5.293 2H2.5a.5.5 0 0 1-.5-.5" clip-rule=evenodd /></svg></a></ul></div><div><div class=footerTitle_tbhc>More</div><ul class="footerList_lK9E clean-list"><li><a href=https://apify.com target=_blank rel="noopener noreferrer" class="footer__link-item footerLink_YJ8n">Apify Platform<svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16" class=externalLinkIcon_gEsj><path fill=#fff fill-rule=evenodd d="M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V2.707L1.854 6.854a.5.5 0 1 1-.708-.708L5.293 2H2.5a.5.5 0 0 1-.5-.5" clip-rule=evenodd /></svg></a><li><a href=https://docusaurus.io target=_blank rel="noopener noreferrer" class="footer__link-item footerLink_YJ8n">Docusaurus<svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16" class=externalLinkIcon_gEsj><path fill=#fff fill-rule=evenodd d="M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V2.707L1.854 6.854a.5.5 0 1 1-.708-.708L5.293 2H2.5a.5.5 0 0 1-.5-.5" clip-rule=evenodd /></svg></a><li><a href=https://github.com/apify/crawlee target=_blank rel="noopener noreferrer" class="footer__link-item footerLink_YJ8n">GitHub<svg xmlns=http://www.w3.org/2000/svg width=16 height=16 fill=none viewBox="0 0 16 16" class=externalLinkIcon_gEsj><path fill=#fff fill-rule=evenodd d="M2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V2.707L1.854 6.854a.5.5 0 1 1-.708-.708L5.293 2H2.5a.5.5 0 0 1-.5-.5" clip-rule=evenodd /></svg></a></ul></div></div></div></div><div class=footerBottom_VaxJ><div class=footerBottomRow_vynO><div><svg xmlns=http://www.w3.org/2000/svg width=14 height=12 fill=none viewBox="0 0 14 12" class=hearthIcon_zliG><path fill=#B2B8CC d="M3.653.049a4 4 0 0 1 3.325.95l.025.022.022-.02a4 4 0 0 1 3.156-.96l.164.024a4 4 0 0 1 2.242 6.672l-.12.123-.032.028-4.966 4.919a.67.67 0 0 1-.876.055l-.062-.055-4.996-4.948A4 4 0 0 1 3.653.049"/></svg>Crawlee is forever free and open source</div><div>© 2025 Apify</div></div></div></footer></div>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P7MCS7" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->