"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["6021"],{86450:function(e,n,o){o.r(n),o.d(n,{default:()=>m,frontMatter:()=>c,metadata:()=>s,assets:()=>p,toc:()=>h,contentTitle:()=>d});var s=JSON.parse('{"id":"guides/session-management","title":"Session Management","description":"How to manage your cookies, proxy IP rotations and more","source":"@site/versioned_docs/version-3.11/guides/session_management.mdx","sourceDirName":"guides","slug":"/guides/session-management","permalink":"/docs/3.11/guides/session-management","draft":false,"unlisted":false,"editUrl":"https://github.com/apify/crawlee/edit/master/website/versioned_docs/version-3.11/guides/session_management.mdx","tags":[],"version":"3.11","lastUpdatedBy":"Jind\u0159ich B\xe4r","lastUpdatedAt":1720711256000,"frontMatter":{"id":"session-management","title":"Session Management","description":"How to manage your cookies, proxy IP rotations and more"},"sidebar":"docs","previous":{"title":"Proxy Management","permalink":"/docs/3.11/guides/proxy-management"},"next":{"title":"Scaling our crawlers","permalink":"/docs/3.11/guides/scaling-crawlers"}}'),t=o("85893"),r=o("50065"),i=o("47927"),a=o("58168"),l=o("97645"),u=o("96199");let c={id:"session-management",title:"Session Management",description:"How to manage your cookies, proxy IP rotations and more"},d=void 0,p={},h=[];function f(e){let n={a:"a",code:"code",li:"li",p:"p",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["\u200B",(0,t.jsx)(i.Z,{to:"core/class/SessionPool",children:(0,t.jsx)(n.code,{children:"SessionPool"})})," is a class that allows us to handle the rotation of proxy IP addresses along with cookies and other custom settings in Crawlee."]}),"\n",(0,t.jsx)(n.p,{children:"The main benefit of using Session pool is that we can filter out blocked or non-working proxies,\nso our actor does not retry requests over known blocked/non-working proxies.\nAnother benefit of using SessionPool is that we can store information tied tightly to an IP address,\nsuch as cookies, auth tokens, and particular headers. Having our cookies and other identifiers used only with a specific IP will reduce the chance of being blocked.\nThe last but not least benefit is the even rotation of IP addresses - SessionPool  picks the session randomly,\nwhich should prevent burning out a small pool of available IPs."}),"\n",(0,t.jsxs)(n.p,{children:["Check out the ",(0,t.jsx)(n.a,{href:"./avoid-blocking",children:"avoid blocking guide"})," for more information about blocking."]}),"\n",(0,t.jsx)(n.p,{children:"Now let's take a look at the examples of how to use Session pool:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["with ",(0,t.jsx)(i.Z,{to:"basic-crawler/class/BasicCrawler",children:(0,t.jsx)(n.code,{children:"BasicCrawler"})}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["with ",(0,t.jsx)(i.Z,{to:"http-crawler/class/HttpCrawler",children:(0,t.jsx)(n.code,{children:"HttpCrawler"})}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["with ",(0,t.jsx)(i.Z,{to:"cheerio-crawler/class/CheerioCrawler",children:(0,t.jsx)(n.code,{children:"CheerioCrawler"})}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["with ",(0,t.jsx)(i.Z,{to:"jsdom-crawler/class/JSDOMCrawler",children:(0,t.jsx)(n.code,{children:"JSDOMCrawler"})}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["with ",(0,t.jsx)(i.Z,{to:"playwright-crawler/class/PlaywrightCrawler",children:(0,t.jsx)(n.code,{children:"PlaywrightCrawler"})}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["with ",(0,t.jsx)(i.Z,{to:"puppeteer-crawler/class/PuppeteerCrawler",children:(0,t.jsx)(n.code,{children:"PuppeteerCrawler"})}),";"]}),"\n",(0,t.jsx)(n.li,{children:"without a crawler (standalone usage to manage sessions manually)."}),"\n"]}),"\n",(0,t.jsxs)(a.Z,{groupId:"session_pool",children:[(0,t.jsx)(l.Z,{value:"basic",label:"BasicCrawler",children:(0,t.jsx)(u.default,{language:"js",children:"import { BasicCrawler, ProxyConfiguration } from 'crawlee';\nimport { gotScraping } from 'got-scraping';\n\nconst proxyConfiguration = new ProxyConfiguration({\n    /* opts */\n});\n\nconst crawler = new BasicCrawler({\n    // Activates the Session pool (default is true).\n    useSessionPool: true,\n    // Overrides default Session pool configuration.\n    sessionPoolOptions: { maxPoolSize: 100 },\n    async requestHandler({ request, session }) {\n        const { url } = request;\n        const requestOptions = {\n            url,\n            // We use session id in order to have the same proxyUrl\n            // for all the requests using the same session.\n            proxyUrl: await proxyConfiguration.newUrl(session.id),\n            throwHttpErrors: false,\n            headers: {\n                // If you want to use the cookieJar.\n                // This way you get the Cookie headers string from session.\n                Cookie: session.getCookieString(url),\n            },\n        };\n        let response;\n\n        try {\n            response = await gotScraping(requestOptions);\n        } catch (e) {\n            if (e === 'SomeNetworkError') {\n                // If a network error happens, such as timeout, socket hangup, etc.\n                // There is usually a chance that it was just bad luck\n                // and the proxy works. No need to throw it away.\n                session.markBad();\n            }\n            throw e;\n        }\n\n        // Automatically retires the session based on response HTTP status code.\n        session.retireOnBlockedStatusCodes(response.statusCode);\n\n        if (response.body.blocked) {\n            // You are sure it is blocked.\n            // This will throw away the session.\n            session.retire();\n        }\n\n        // Everything is ok, you can get the data.\n        // No need to call session.markGood -> BasicCrawler calls it for you.\n\n        // If you want to use the CookieJar in session you need.\n        session.setCookiesFromResponse(response);\n    },\n});\n"})}),(0,t.jsx)(l.Z,{value:"http",label:"HttpCrawler",children:(0,t.jsx)(u.default,{language:"js",children:"import { HttpCrawler, ProxyConfiguration } from 'crawlee';\n\nconst proxyConfiguration = new ProxyConfiguration({\n    /* opts */\n});\n\nconst crawler = new HttpCrawler({\n    // To use the proxy IP session rotation logic, you must turn the proxy usage on.\n    proxyConfiguration,\n    // Activates the Session pool (default is true).\n    useSessionPool: true,\n    // Overrides default Session pool configuration.\n    sessionPoolOptions: { maxPoolSize: 100 },\n    // Set to true if you want the crawler to save cookies per session,\n    // and set the cookie header to request automatically (default is true).\n    persistCookiesPerSession: true,\n    async requestHandler({ session, body }) {\n        const title = body.match(/<title(?:.*?)>(.*?)<\\/title>/)?.[1];\n\n        if (title === 'Blocked') {\n            session.retire();\n        } else if (title === 'Not sure if blocked, might also be a connection error') {\n            session.markBad();\n        } else {\n            // session.markGood() - this step is done automatically in BasicCrawler.\n        }\n    },\n});\n"})}),(0,t.jsx)(l.Z,{value:"cheerio",label:"CheerioCrawler",default:!0,children:(0,t.jsx)(u.default,{language:"js",children:"import { CheerioCrawler, ProxyConfiguration } from 'crawlee';\n\nconst proxyConfiguration = new ProxyConfiguration({\n    /* opts */\n});\n\nconst crawler = new CheerioCrawler({\n    // To use the proxy IP session rotation logic, you must turn the proxy usage on.\n    proxyConfiguration,\n    // Activates the Session pool (default is true).\n    useSessionPool: true,\n    // Overrides default Session pool configuration.\n    sessionPoolOptions: { maxPoolSize: 100 },\n    // Set to true if you want the crawler to save cookies per session,\n    // and set the cookie header to request automatically (default is true).\n    persistCookiesPerSession: true,\n    async requestHandler({ session, $ }) {\n        const title = $('title').text();\n\n        if (title === 'Blocked') {\n            session.retire();\n        } else if (title === 'Not sure if blocked, might also be a connection error') {\n            session.markBad();\n        } else {\n            // session.markGood() - this step is done automatically in BasicCrawler.\n        }\n    },\n});\n"})}),(0,t.jsx)(l.Z,{value:"jsdom",label:"JSDOMCrawler",children:(0,t.jsx)(u.default,{language:"js",children:"import { JSDOMCrawler, ProxyConfiguration } from 'crawlee';\n\nconst proxyConfiguration = new ProxyConfiguration({\n    /* opts */\n});\n\nconst crawler = new JSDOMCrawler({\n    // To use the proxy IP session rotation logic, you must turn the proxy usage on.\n    proxyConfiguration,\n    // Activates the Session pool (default is true).\n    useSessionPool: true,\n    // Overrides default Session pool configuration.\n    sessionPoolOptions: { maxPoolSize: 100 },\n    // Set to true if you want the crawler to save cookies per session,\n    // and set the cookie header to request automatically (default is true).\n    persistCookiesPerSession: true,\n    async requestHandler({ session, window }) {\n        const title = window.document.title;\n\n        if (title === 'Blocked') {\n            session.retire();\n        } else if (title === 'Not sure if blocked, might also be a connection error') {\n            session.markBad();\n        } else {\n            // session.markGood() - this step is done automatically in BasicCrawler.\n        }\n    },\n});\n"})}),(0,t.jsx)(l.Z,{value:"playwright",label:"PlaywrightCrawler",children:(0,t.jsx)(u.default,{language:"js",children:"import { PlaywrightCrawler, ProxyConfiguration } from 'crawlee';\n\nconst proxyConfiguration = new ProxyConfiguration({\n    /* opts */\n});\n\nconst crawler = new PlaywrightCrawler({\n    // To use the proxy IP session rotation logic, you must turn the proxy usage on.\n    proxyConfiguration,\n    // Activates the Session pool (default is true).\n    useSessionPool: true,\n    // Overrides default Session pool configuration\n    sessionPoolOptions: { maxPoolSize: 100 },\n    // Set to true if you want the crawler to save cookies per session,\n    // and set the cookies to page before navigation automatically (default is true).\n    persistCookiesPerSession: true,\n    async requestHandler({ page, session }) {\n        const title = await page.title();\n\n        if (title === 'Blocked') {\n            session.retire();\n        } else if (title === 'Not sure if blocked, might also be a connection error') {\n            session.markBad();\n        } else {\n            // session.markGood() - this step is done automatically in PlaywrightCrawler.\n        }\n    },\n});\n"})}),(0,t.jsx)(l.Z,{value:"puppeteer",label:"PuppeteerCrawler",children:(0,t.jsx)(u.default,{language:"js",children:"import { PuppeteerCrawler, ProxyConfiguration } from 'crawlee';\n\nconst proxyConfiguration = new ProxyConfiguration({\n    /* opts */\n});\n\nconst crawler = new PuppeteerCrawler({\n    // To use the proxy IP session rotation logic, you must turn the proxy usage on.\n    proxyConfiguration,\n    // Activates the Session pool (default is true).\n    useSessionPool: true,\n    // Overrides default Session pool configuration\n    sessionPoolOptions: { maxPoolSize: 100 },\n    // Set to true if you want the crawler to save cookies per session,\n    // and set the cookies to page before navigation automatically (default is true).\n    persistCookiesPerSession: true,\n    async requestHandler({ page, session }) {\n        const title = await page.title();\n\n        if (title === 'Blocked') {\n            session.retire();\n        } else if (title === 'Not sure if blocked, might also be a connection error') {\n            session.markBad();\n        } else {\n            // session.markGood() - this step is done automatically in PuppeteerCrawler.\n        }\n    },\n});\n"})}),(0,t.jsx)(l.Z,{value:"standalone",label:"Standalone",children:(0,t.jsx)(u.default,{language:"js",children:"import { SessionPool } from 'crawlee';\n\n// Override the default Session pool configuration.\nconst sessionPoolOptions = {\n    maxPoolSize: 100,\n};\n\n// Open Session Pool.\nconst sessionPool = await SessionPool.open(sessionPoolOptions);\n\n// Get session.\nconst session = await sessionPool.getSession();\n\n// Increase the errorScore.\nsession.markBad();\n\n// Throw away the session.\nsession.retire();\n\n// Lower the errorScore and mark the session good.\nsession.markGood();\n"})})]}),"\n",(0,t.jsx)(n.p,{children:"These are the basics of configuring SessionPool.\nPlease, bear in mind that a Session pool needs time to find working IPs and build up the pool,\nso we will probably see a lot of errors until it becomes stabilized."})]})}function m(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(f,{...e})}):f(e)}},97645:function(e,n,o){o.d(n,{Z:()=>r});var s=o("85893");o("67294");var t=o("67026");function r(e){let{children:n,hidden:o,className:r}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.Z)("tabItem_Ymn6",r),hidden:o,children:n})}},58168:function(e,n,o){o.d(n,{Z:()=>y});var s=o("85893"),t=o("67294"),r=o("67026"),i=o("34718"),a=o("16550"),l=o("8714"),u=o("89207"),c=o("69413"),d=o("54510");function p(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||t.isValidElement(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){let{value:n,tabValues:o}=e;return o.some(e=>e.value===n)}var f=o("6735");function m(e){let{className:n,block:o,selectedValue:t,selectValue:a,tabValues:l}=e,u=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.o5)(),d=e=>{let n=e.currentTarget,o=l[u.indexOf(n)].value;o!==t&&(c(n),a(o))},p=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let o=u.indexOf(e.currentTarget)+1;n=u[o]??u[0];break}case"ArrowLeft":{let o=u.indexOf(e.currentTarget)-1;n=u[o]??u[u.length-1]}}n?.focus()};return(0,s.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":o},n),children:l.map(e=>{let{value:n,label:o,attributes:i}=e;return(0,s.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{u.push(e)},onKeyDown:p,onClick:d,...i,className:(0,r.Z)("tabs__item","tabItem_LNqP",i?.className,{"tabs__item--active":t===n}),children:o??n},n)})})}function w(e){let{lazy:n,children:o,selectedValue:i}=e,a=(Array.isArray(o)?o:[o]).filter(Boolean);if(n){let e=a.find(e=>e.props.value===i);return e?(0,t.cloneElement)(e,{className:(0,r.Z)("margin-top--md",e.props.className)}):null}return(0,s.jsx)("div",{className:"margin-top--md",children:a.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i}))})}function g(e){let n=function(e){let{defaultValue:n,queryString:o=!1,groupId:s}=e,r=function(e){let{values:n,children:o}=e;return(0,t.useMemo)(()=>{let e=n??p(o).map(e=>{let{props:{value:n,label:o,attributes:s,default:t}}=e;return{value:n,label:o,attributes:s,default:t}});return!function(e){let n=(0,c.lx)(e,(e,n)=>e.value===n.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,o])}(e),[i,f]=(0,t.useState)(()=>(function(e){let{defaultValue:n,tabValues:o}=e;if(0===o.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:o}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${o.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let s=o.find(e=>e.default)??o[0];if(!s)throw Error("Unexpected error: 0 tabValues");return s.value})({defaultValue:n,tabValues:r})),[m,w]=function(e){let{queryString:n=!1,groupId:o}=e,s=(0,a.k6)(),r=function(e){let{queryString:n=!1,groupId:o}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!o)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:n,groupId:o});return[(0,u._X)(r),(0,t.useCallback)(e=>{if(!r)return;let n=new URLSearchParams(s.location.search);n.set(r,e),s.replace({...s.location,search:n.toString()})},[r,s])]}({queryString:o,groupId:s}),[g,y]=function(e){let{groupId:n}=e,o=n?`docusaurus.tab.${n}`:null,[s,r]=(0,d.Nk)(o);return[s,(0,t.useCallback)(e=>{o&&r.set(e)},[o,r])]}({groupId:s}),x=(()=>{let e=m??g;return h({value:e,tabValues:r})?e:null})();return(0,l.Z)(()=>{x&&f(x)},[x]),{selectedValue:i,selectValue:(0,t.useCallback)(e=>{if(!h({value:e,tabValues:r}))throw Error(`Can't select invalid tab value=${e}`);f(e),w(e),y(e)},[w,y,r]),tabValues:r}}(e);return(0,s.jsxs)("div",{className:(0,r.Z)("tabs-container","tabList__CuJ"),children:[(0,s.jsx)(m,{...n,...e}),(0,s.jsx)(w,{...n,...e})]})}function y(e){let n=(0,f.Z)();return(0,s.jsx)(g,{...e,children:p(e.children)},String(n))}},47927:function(e,n,o){o.d(n,{Z:function(){return c}});var s=o(85893);o(67294);var t=o(53367),r=o(89873),i=o(87262);let[a,l]=o(99074).version.split("."),u=[a,l].join("."),c=e=>{let{to:n,children:o}=e,a=(0,r.E)(),{siteConfig:l}=(0,i.default)();return l.presets[0][1].docs.disableVersioning||a.version===u?(0,s.jsx)(t.default,{to:`/api/${n}`,children:o}):(0,s.jsx)(t.default,{to:`/api/${"current"===a.version?"next":a.version}/${n}`,children:o})}},50065:function(e,n,o){o.d(n,{Z:function(){return a},a:function(){return i}});var s=o(67294);let t={},r=s.createContext(t);function i(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},99074:function(e){e.exports=JSON.parse('{"name":"crawlee","version":"3.13.0","description":"The scalable web crawling and scraping library for JavaScript/Node.js. Enables development of data extraction and web automation jobs (not only) with headless Chrome and Puppeteer.","engines":{"node":">=16.0.0"},"bin":"./src/cli.ts","main":"./dist/index.js","module":"./dist/index.mjs","types":"./dist/index.d.ts","exports":{".":{"import":"./dist/index.mjs","require":"./dist/index.js","types":"./dist/index.d.ts"},"./package.json":"./package.json"},"keywords":["apify","headless","chrome","puppeteer","crawler","scraper"],"author":{"name":"Apify","email":"support@apify.com","url":"https://apify.com"},"contributors":["Jan Curn <jan@apify.com>","Marek Trunkat <marek@apify.com>","Ondra Urban <ondra@apify.com>"],"license":"Apache-2.0","repository":{"type":"git","url":"git+https://github.com/apify/crawlee"},"bugs":{"url":"https://github.com/apify/crawlee/issues"},"homepage":"https://crawlee.dev","scripts":{"build":"yarn clean && yarn compile && yarn copy","clean":"rimraf ./dist","compile":"tsc -p tsconfig.build.json && gen-esm-wrapper ./dist/index.js ./dist/index.mjs","copy":"tsx ../../scripts/copy.ts"},"publishConfig":{"access":"public"},"dependencies":{"@crawlee/basic":"3.13.0","@crawlee/browser":"3.13.0","@crawlee/browser-pool":"3.13.0","@crawlee/cheerio":"3.13.0","@crawlee/cli":"3.13.0","@crawlee/core":"3.13.0","@crawlee/http":"3.13.0","@crawlee/jsdom":"3.13.0","@crawlee/linkedom":"3.13.0","@crawlee/playwright":"3.13.0","@crawlee/puppeteer":"3.13.0","@crawlee/utils":"3.13.0","import-local":"^3.1.0","tslib":"^2.4.0"},"peerDependencies":{"playwright":"*","puppeteer":"*"},"peerDependenciesMeta":{"playwright":{"optional":true},"puppeteer":{"optional":true}}}')}}]);