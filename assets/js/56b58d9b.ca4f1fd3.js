"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["68047"],{58642:function(e,t,r){r.r(t),r.d(t,{default:()=>g,frontMatter:()=>c,metadata:()=>n,assets:()=>d,toc:()=>h,contentTitle:()=>u});var n=JSON.parse('{"id":"guides/javascript-rendering","title":"JavaScript rendering","description":"Your first steps into the world of scraping with Crawlee","source":"@site/versioned_docs/version-3.5/guides/javascript-rendering.mdx","sourceDirName":"guides","slug":"/guides/javascript-rendering","permalink":"/docs/3.5/guides/javascript-rendering","draft":false,"unlisted":false,"editUrl":"https://github.com/apify/crawlee/edit/master/website/versioned_docs/version-3.5/guides/javascript-rendering.mdx","tags":[],"version":"3.5","lastUpdatedBy":"Martin Ad\xe1mek","lastUpdatedAt":1690788771000,"frontMatter":{"id":"javascript-rendering","title":"JavaScript rendering","description":"Your first steps into the world of scraping with Crawlee"},"sidebar":"docs","previous":{"title":"CheerioCrawler","permalink":"/docs/3.5/guides/cheerio-crawler-guide"},"next":{"title":"Proxy Management","permalink":"/docs/3.5/guides/proxy-management"}}'),a=r("85893"),o=r("50065"),s=r("58168"),i=r("97645"),l=r("96199");let c={id:"javascript-rendering",title:"JavaScript rendering",description:"Your first steps into the world of scraping with Crawlee"},u=void 0,d={},h=[{value:"Headless browsers",id:"headless-browsers",level:2},{value:"Waiting for elements to render",id:"waiting-for-elements-to-render",level:2},{value:"We&#39;re not kidding",id:"were-not-kidding",level:3}];function p(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"JavaScript rendering is the process of executing JavaScript on a page to make changes in the page's structure or content. It's also called client-side rendering, the opposite of server-side rendering. Some modern websites render on the client, some on the server and many cutting edge websites render some things on the server and other things on the client."}),"\n",(0,a.jsxs)(t.p,{children:["The Crawlee website does not use JavaScript rendering to display its content, so we have to look for an example elsewhere. ",(0,a.jsx)(t.a,{href:"https://apify.com/store",target:"_blank",rel:"noopener",children:"Apify Store"})," is a library of scrapers and automations called ",(0,a.jsx)(t.strong,{children:"actors"})," that anyone can grab and use for free. It uses JavaScript rendering to display the list of actors, so let's use it to demonstrate how it works."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="src/main.mjs"',children:"import { CheerioCrawler } from 'crawlee';\n\nconst crawler = new CheerioCrawler({\n    async requestHandler({ $, request }) {\n        // Extract text content of an actor card\n        const actorText = $('.ActorStoreItem').text();\n        console.log(`ACTOR: ${actorText}`);\n    }\n})\n\nawait crawler.run(['https://apify.com/store']);\n"})}),"\n",(0,a.jsx)(t.p,{children:"Run the code, and you'll see that the crawler won't print the content of the actor card."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-log",children:"ACTOR:\n"})}),"\n",(0,a.jsxs)(t.p,{children:["That's because Apify Store uses client-side JavaScript to render its content and ",(0,a.jsx)(t.code,{children:"CheerioCrawler"})," can't execute it, so the text never appears in the page's HTML."]}),"\n",(0,a.jsxs)(t.p,{children:["You can confirm this using Chrome DevTools. If you go to ",(0,a.jsx)(t.a,{href:"https://apify.com/store",target:"_blank",rel:"noopener",children:"https://apify.com/store"}),", right-click anywhere in the page, select ",(0,a.jsx)(t.strong,{children:"View Page Source"})," and search for ",(0,a.jsx)(t.strong,{children:"ActorStoreItem"})," you won't find any results. Then, if you right-click again, select ",(0,a.jsx)(t.strong,{children:"Inspect"})," and search for the same ",(0,a.jsx)(t.strong,{children:"ActorStoreItem"}),", you will find many of them."]}),"\n",(0,a.jsxs)(t.p,{children:["How's this possible? Because ",(0,a.jsx)(t.strong,{children:"View Page Source"})," shows the original HTML, before any JavaScript executions. That's what ",(0,a.jsx)(t.code,{children:"CheerioCrawler"})," gets. Whereas with ",(0,a.jsx)(t.strong,{children:"Inspect"})," you see the current HTML - after JavaScript execution. When you understand this, it's not a huge surprise that ",(0,a.jsx)(t.code,{children:"CheerioCrawler"})," can't find the data. For that we need a headless browser."]}),"\n",(0,a.jsx)(t.h2,{id:"headless-browsers",children:"Headless browsers"}),"\n",(0,a.jsxs)(t.p,{children:["To get the contents of ",(0,a.jsx)(t.code,{children:".ActorStoreItem"}),", you will have to use a headless browser. You can choose from two libraries to control your browser: ",(0,a.jsx)(t.a,{href:"https://github.com/puppeteer/puppeteer",target:"_blank",rel:"noopener",children:"Puppeteer"})," or ",(0,a.jsx)(t.a,{href:"https://github.com/microsoft/playwright",target:"_blank",rel:"noopener",children:"Playwright"}),". The choice is simple. If you know one of them, choose the one you know. If you know both, or none, choose Playwright, because it's better in most cases."]}),"\n",(0,a.jsx)(t.h2,{id:"waiting-for-elements-to-render",children:"Waiting for elements to render"}),"\n",(0,a.jsx)(t.p,{children:"No matter which library you pick, here's example code for both. Playwright is a little more pleasant to use, but both libraries will get the job done. The big difference between them is that Playwright will automatically wait for elements to appear, whereas in Puppeteer, you have to explicitly wait for them."}),"\n",(0,a.jsxs)(s.Z,{groupId:"javascript-rendering",children:[(0,a.jsx)(i.Z,{value:"playwright",label:"PlaywrightCrawler",children:(0,a.jsx)(l.default,{language:"js",title:"src/main.mjs",children:"import { PlaywrightCrawler } from 'crawlee';\n\nconst crawler = new PlaywrightCrawler({\n    async requestHandler({ page }) {\n        // page.locator points to an element in the DOM\n        // using a CSS selector, but it does not access it yet.\n        const actorCard = page.locator('.ActorStoreItem').first();\n        // Upon calling one of the locator methods Playwright\n        // waits for the element to render and then accesses it.\n        const actorText = await actorCard.textContent();\n        console.log(`ACTOR: ${actorText}`);\n    },\n});\n\nawait crawler.run(['https://apify.com/store']);\n"})}),(0,a.jsx)(i.Z,{value:"puppeteer",label:"PuppeteerCrawler",children:(0,a.jsx)(l.default,{language:"js",title:"src/main.mjs",children:"import { PuppeteerCrawler } from 'crawlee';\n\nconst crawler = new PuppeteerCrawler({\n    async requestHandler({ page }) {\n        // Puppeteer does not have the automatic waiting functionality\n        // of Playwright, so we have to explicitly wait for the element.\n        await page.waitForSelector('.ActorStoreItem');\n        // Puppeteer does not have helper methods like locator.textContent,\n        // so we have to manually extract the value using in-page JavaScript.\n        const actorText = await page.$eval('.ActorStoreItem', (el) => {\n            return el.textContent;\n        });\n        console.log(`ACTOR: ${actorText}`);\n    },\n});\n\nawait crawler.run(['https://apify.com/store']);\n"})})]}),"\n",(0,a.jsxs)(t.p,{children:["When you run the code, you'll see the ",(0,a.jsx)(t.em,{children:"badly formatted"})," content of the first actor card printed to console:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-log",children:"ACTOR: Web Scraperapify/web-scraperCrawls arbitrary websites using [...]\n"})}),"\n",(0,a.jsx)(t.h3,{id:"were-not-kidding",children:"We're not kidding"}),"\n",(0,a.jsx)(t.p,{children:"If you don't believe us that the elements need to be waited for, run the following code which skips the waiting."}),"\n",(0,a.jsxs)(s.Z,{groupId:"javascript-rendering",children:[(0,a.jsx)(i.Z,{value:"playwright",label:"PlaywrightCrawler",children:(0,a.jsx)(l.default,{language:"js",title:"src/main.mjs",children:"import { PlaywrightCrawler } from 'crawlee';\n\nconst crawler = new PlaywrightCrawler({\n    async requestHandler({ page }) {\n        // Here we don't wait for the selector and immediately\n        // extract the text content from the page.\n        const actorText = await page.$eval('.ActorStoreItem', (el) => {\n            return el.textContent;\n        });\n        console.log(`ACTOR: ${actorText}`);\n    },\n});\n\nawait crawler.run(['https://apify.com/store']);\n"})}),(0,a.jsx)(i.Z,{value:"puppeteer",label:"PuppeteerCrawler",children:(0,a.jsx)(l.default,{language:"js",title:"src/main.mjs",children:"import { PuppeteerCrawler } from 'crawlee';\n\nconst crawler = new PuppeteerCrawler({\n    async requestHandler({ page }) {\n        // Here we don't wait for the selector and immediately\n        // extract the text content from the page.\n        const actorText = await page.$eval('.ActorStoreItem', (el) => {\n            return el.textContent;\n        });\n        console.log(`ACTOR: ${actorText}`);\n    },\n});\n\nawait crawler.run(['https://apify.com/store']);\n"})})]}),"\n",(0,a.jsx)(t.p,{children:"In both cases, the request will be retried a few times and eventually fail with an error like this:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-log",children:'ERROR [...] Error: failed to find element matching selector ".ActorStoreItem"\n'})}),"\n",(0,a.jsx)(t.p,{children:"That's because when you try to access the element in the browser, it's not been rendered in the DOM yet."}),"\n",(0,a.jsx)(t.admonition,{type:"tip",children:(0,a.jsxs)(t.p,{children:["This guide only touches the concept of JavaScript rendering and use of headless browsers. To learn more, continue with the ",(0,a.jsx)(t.a,{href:"https://developers.apify.com/academy/puppeteer-playwright",target:"_blank",rel:"noopener",children:"Puppeteer & Playwright course"})," in the Apify Academy. ",(0,a.jsx)(t.strong,{children:"It's free and open-source"})," \u2764\uFE0F."]})})]})}function g(e={}){let{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},97645:function(e,t,r){r.d(t,{Z:()=>o});var n=r("85893");r("67294");var a=r("67026");function o(e){let{children:t,hidden:r,className:o}=e;return(0,n.jsx)("div",{role:"tabpanel",className:(0,a.Z)("tabItem_Ymn6",o),hidden:r,children:t})}},58168:function(e,t,r){r.d(t,{Z:()=>x});var n=r("85893"),a=r("67294"),o=r("67026"),s=r("34718"),i=r("16550"),l=r("8714"),c=r("89207"),u=r("69413"),d=r("54510");function h(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||a.isValidElement(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){let{value:t,tabValues:r}=e;return r.some(e=>e.value===t)}var g=r("6735");function f(e){let{className:t,block:r,selectedValue:a,selectValue:i,tabValues:l}=e,c=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.o5)(),d=e=>{let t=e.currentTarget,r=l[c.indexOf(t)].value;r!==a&&(u(t),i(r))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let r=c.indexOf(e.currentTarget)+1;t=c[r]??c[0];break}case"ArrowLeft":{let r=c.indexOf(e.currentTarget)-1;t=c[r]??c[c.length-1]}}t?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":r},t),children:l.map(e=>{let{value:t,label:r,attributes:s}=e;return(0,n.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>{c.push(e)},onKeyDown:h,onClick:d,...s,className:(0,o.Z)("tabs__item","tabItem_LNqP",s?.className,{"tabs__item--active":a===t}),children:r??t},t)})})}function m(e){let{lazy:t,children:r,selectedValue:s}=e,i=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){let e=i.find(e=>e.props.value===s);return e?(0,a.cloneElement)(e,{className:(0,o.Z)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==s}))})}function w(e){let t=function(e){let{defaultValue:t,queryString:r=!1,groupId:n}=e,o=function(e){let{values:t,children:r}=e;return(0,a.useMemo)(()=>{let e=t??h(r).map(e=>{let{props:{value:t,label:r,attributes:n,default:a}}=e;return{value:t,label:r,attributes:n,default:a}});return!function(e){let t=(0,u.lx)(e,(e,t)=>e.value===t.value);if(t.length>0)throw Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,r])}(e),[s,g]=(0,a.useState)(()=>(function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:r}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}let n=r.find(e=>e.default)??r[0];if(!n)throw Error("Unexpected error: 0 tabValues");return n.value})({defaultValue:t,tabValues:o})),[f,m]=function(e){let{queryString:t=!1,groupId:r}=e,n=(0,i.k6)(),o=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,c._X)(o),(0,a.useCallback)(e=>{if(!o)return;let t=new URLSearchParams(n.location.search);t.set(o,e),n.replace({...n.location,search:t.toString()})},[o,n])]}({queryString:r,groupId:n}),[w,x]=function(e){let{groupId:t}=e,r=t?`docusaurus.tab.${t}`:null,[n,o]=(0,d.Nk)(r);return[n,(0,a.useCallback)(e=>{r&&o.set(e)},[r,o])]}({groupId:n}),y=(()=>{let e=f??w;return p({value:e,tabValues:o})?e:null})();return(0,l.Z)(()=>{y&&g(y)},[y]),{selectedValue:s,selectValue:(0,a.useCallback)(e=>{if(!p({value:e,tabValues:o}))throw Error(`Can't select invalid tab value=${e}`);g(e),m(e),x(e)},[m,x,o]),tabValues:o}}(e);return(0,n.jsxs)("div",{className:(0,o.Z)("tabs-container","tabList__CuJ"),children:[(0,n.jsx)(f,{...t,...e}),(0,n.jsx)(m,{...t,...e})]})}function x(e){let t=(0,g.Z)();return(0,n.jsx)(w,{...e,children:h(e.children)},String(t))}},50065:function(e,t,r){r.d(t,{Z:function(){return i},a:function(){return s}});var n=r(67294);let a={},o=n.createContext(a);function s(e){let t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);