"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["46243"],{96511:function(e,n,o){o.r(n),o.d(n,{contentTitle:function(){return a},default:function(){return c},frontMatter:function(){return t},toc:function(){return i}});var r=o(85893),s=o(50065);let t={},a=void 0,i=[{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Launching multiple browsers",id:"launching-multiple-browsers",level:2},{value:"Features",id:"features",level:2},{value:"Simple configuration",id:"simple-configuration",level:3},{value:"Proxy management",id:"proxy-management",level:3},{value:"Lifecycle management with hooks",id:"lifecycle-management-with-hooks",level:3},{value:"Manipulating playwright context using <code>pageOptions</code> or <code>launchOptions</code>",id:"manipulating-playwright-context-using-pageoptions-or-launchoptions",level:3},{value:"Single API for common operations",id:"single-api-for-common-operations",level:3},{value:"Graceful browser closing",id:"graceful-browser-closing",level:3},{value:"Changing browser fingerprints a.k.a. browser signatures",id:"changing-browser-fingerprints-aka-browser-signatures",level:3}];function l(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Browser Pool is a small, but powerful and extensible library, that allows you to seamlessly control multiple headless browsers at the same time with only a little configuration, and a single function call. Currently, it supports ",(0,r.jsx)(n.a,{href:"https://github.com/puppeteer/puppeteer",children:"Puppeteer"}),", ",(0,r.jsx)(n.a,{href:"https://github.com/microsoft/playwright",children:"Playwright"}),", and it can be easily extended with plugins."]}),"\n",(0,r.jsx)(n.p,{children:"We created Browser Pool because we regularly needed to execute tasks concurrently in many headless browsers and their pages, but we did not want to worry about launching browsers, closing browsers, restarting them after crashes and so on. We also wanted to easily and reliably manage the whole browser/page lifecycle."}),"\n",(0,r.jsx)(n.p,{children:"You can use Browser Pool for scraping the internet at scale, testing your website in multiple browsers at the same time or launching web automation robots."}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsxs)(n.p,{children:["Use NPM or Yarn to install ",(0,r.jsx)(n.code,{children:"@crawlee/browser-pool"}),". Note that ",(0,r.jsx)(n.code,{children:"@crawlee/browser-pool"})," does not come preinstalled with browser automation libraries. This allows you to choose your own libraries and their versions, and it also makes ",(0,r.jsx)(n.code,{children:"@crawlee/browser-pool"})," much smaller."]}),"\n",(0,r.jsxs)(n.p,{children:["Run this command to install ",(0,r.jsx)(n.code,{children:"@crawlee/browser-pool"})," and the ",(0,r.jsx)(n.code,{children:"playwright"})," browser automation library."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install @crawlee/browser-pool playwright\n"})}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsxs)(n.p,{children:["This simple example shows how to open a page in a browser using Browser Pool. We use the provided ",(0,r.jsx)(n.code,{children:"PlaywrightPlugin"})," to wrap a Playwright installation of your own. By calling ",(0,r.jsx)(n.code,{children:"browserPool.newPage()"})," you launch a new Firefox browser and open a new page in that browser."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { BrowserPool, PlaywrightPlugin } from '@crawlee/browser-pool';\nimport playwright from 'playwright';\n\nconst browserPool = new BrowserPool({\n    browserPlugins: [new PlaywrightPlugin(playwright.chromium)],\n});\n\n// Launches Chromium with Playwright and returns a Playwright Page.\nconst page1 = await browserPool.newPage();\n// You can interact with the page as you're used to.\nawait page1.goto('https://example.com');\n// When you're done, close the page.\nawait page1.close();\n\n// Opens a second page in the same browser.\nconst page2 = await browserPool.newPage();\n// When everything's finished, tear down the pool.\nawait browserPool.destroy();\n"})}),"\n",(0,r.jsx)(n.h2,{id:"launching-multiple-browsers",children:"Launching multiple browsers"}),"\n",(0,r.jsxs)(n.p,{children:["The basic example shows how to launch a single browser, but the purpose of Browser Pool is to launch many browsers. This is done automatically in the background. You only need to provide the relevant plugins and call ",(0,r.jsx)(n.code,{children:"browserPool.newPage()"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { BrowserPool, PlaywrightPlugin } from '@crawlee/browser-pool';\nimport playwright from 'playwright';\n\nconst browserPool = new BrowserPool({\n    browserPlugins: [\n        new PlaywrightPlugin(playwright.chromium),\n        new PlaywrightPlugin(playwright.firefox),\n        new PlaywrightPlugin(playwright.webkit),\n    ],\n});\n\n// Open 4 pages in 3 browsers. The browsers are launched\n// in a round-robin fashion based on the plugin order.\nconst chromiumPage = await browserPool.newPage();\nconst firefoxPage = await browserPool.newPage();\nconst webkitPage = await browserPool.newPage();\nconst chromiumPage2 = await browserPool.newPage();\n\n// Don't forget to close pages / destroy pool when you're done.\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This round-robin way of opening pages may not be useful for you, if you need to consistently run tasks in multiple environments. For that, there's the ",(0,r.jsx)(n.code,{children:"newPageWithEachPlugin"})," function."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { BrowserPool, PlaywrightPlugin, PuppeteerPlugin } from '@crawlee/browser-pool';\nimport playwright from 'playwright';\nimport puppeteer from 'puppeteer';\n\nconst browserPool = new BrowserPool({\n    browserPlugins: [\n        new PlaywrightPlugin(playwright.chromium),\n        new PuppeteerPlugin(puppeteer),\n    ],\n});\n\nconst pages = await browserPool.newPageWithEachPlugin();\nconst promises = pages.map(async page => {\n    // Run some task with each page\n    // pages are in order of plugins:\n    // [playwrightPage, puppeteerPage]\n    await page.close();\n});\nawait Promise.all(promises);\n\n// Continue with some more work.\n"})}),"\n",(0,r.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,r.jsx)(n.p,{children:"Besides a simple interface for launching browsers, Browser Pool includes other helpful features that make browser management more convenient."}),"\n",(0,r.jsx)(n.h3,{id:"simple-configuration",children:"Simple configuration"}),"\n",(0,r.jsxs)(n.p,{children:["You can easily set the maximum number of pages that can be open in a given browser and also the maximum number of pages to process before a browser ",(0,r.jsx)(n.a,{href:"#graceful-browser-closing",children:"is retired"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const browserPool = new BrowserPool({\n    maxOpenPagesPerBrowser: 20,\n    retireBrowserAfterPageCount: 100,\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can configure the browser launch options either right in the plugins:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const playwrightPlugin = new PlaywrightPlugin(playwright.chromium, {\n    launchOptions: {\n        headless: true,\n    }\n})\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Or dynamically in ",(0,r.jsx)(n.a,{href:"#lifecycle-management-with-hooks",children:"pre-launch hooks"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const browserPool = new BrowserPool({\n    preLaunchHooks: [(pageId, launchContext) => {\n        if (pageId === 'headful') {\n            launchContext.launchOptions.headless = false;\n        }\n    }]\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"proxy-management",children:"Proxy management"}),"\n",(0,r.jsx)(n.p,{children:"When scraping at scale or testing websites from multiple geolocations, one often needs to use proxy servers. Setting up an authenticated proxy in Puppeteer can be cumbersome, so we created a helper that does all the heavy lifting for you. Simply provide a proxy URL with authentication credentials, and you're done. It works the same for Playwright too."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const puppeteerPlugin = new PuppeteerPlugin(puppeteer, {\n    proxyUrl: 'http://<username>:<password>@proxy.com:8000'\n});\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"We plan to extend this by adding a proxy-per-page functionality, allowing you to rotate proxies per page, rather than per browser."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"lifecycle-management-with-hooks",children:"Lifecycle management with hooks"}),"\n",(0,r.jsx)(n.p,{children:"Browser Pool allows you to manage the full browser / page lifecycle by attaching hooks to the most important events. Asynchronous hooks are supported, and their execution order is guaranteed."}),"\n",(0,r.jsxs)(n.p,{children:["The first parameter of each hook is either a ",(0,r.jsx)(n.code,{children:"pageId"})," for the hooks executed before a ",(0,r.jsx)(n.code,{children:"page"})," is created or a ",(0,r.jsx)(n.code,{children:"page"})," afterward. This is useful to keep track of which hook was triggered by which ",(0,r.jsx)(n.code,{children:"newPage()"})," call."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const browserPool = new BrowserPool({\n    browserPlugins: [\n        new PlaywrightPlugin(playwright.chromium),\n    ],\n    preLaunchHooks: [(pageId, launchContext) => {\n        // You can use pre-launch hooks to make dynamic changes\n        // to the launchContext, such as changing a proxyUrl\n        // or updating the browser launchOptions\n\n        pageId === 'my-page' // true\n    }],\n    postPageCreateHooks: [(page, browserController) => {\n        // It makes sense to make global changes to pages\n        // in post-page-create hooks. For example, you can\n        // inject some JavaScript library, such as jQuery.\n\n        browserPool.getPageId(page) === 'my-page' // true\n    }]\n});\n\nawait browserPool.newPage({ id: 'my-page' });\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"See the API Documentation for all hooks and their arguments."}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"manipulating-playwright-context-using-pageoptions-or-launchoptions",children:["Manipulating playwright context using ",(0,r.jsx)(n.code,{children:"pageOptions"})," or ",(0,r.jsx)(n.code,{children:"launchOptions"})]}),"\n",(0,r.jsx)(n.p,{children:"Playwright allows customizing multiple browser attributes by browser context. You can customize some of them once the context is created, but some need to be customized within its creation. This part of the documentation should explain how you can effectively customize the browser context."}),"\n",(0,r.jsxs)(n.p,{children:["First of all, let's take a look at what kind of context strategy you chose. You can choose between two strategies by ",(0,r.jsx)(n.code,{children:"useIncognitoPages"})," ",(0,r.jsx)(n.code,{children:"LaunchContext"})," option."]}),"\n",(0,r.jsxs)(n.p,{children:["Suppose you decide to keep ",(0,r.jsx)(n.code,{children:"useIncognitoPages"})," default ",(0,r.jsx)(n.code,{children:"false"})," and create a shared context across all pages launched by one browser. In this case,  you should pass the ",(0,r.jsx)(n.code,{children:"contextOptions"})," as a ",(0,r.jsx)(n.code,{children:"launchOptions"})," since the context is created within the new browser launch. The ",(0,r.jsx)(n.code,{children:"launchOptions"})," corresponds to these ",(0,r.jsx)(n.a,{href:"https://playwright.dev/docs/api/class-browsertype#browsertypelaunchpersistentcontextuserdatadir-options",children:"playwright options"}),". As you can see, these options contain not only ordinary playwright launch options but also the context options."]}),"\n",(0,r.jsxs)(n.p,{children:["If you set ",(0,r.jsx)(n.code,{children:"useIncognitoPages"})," to ",(0,r.jsx)(n.code,{children:"true"}),", you will create a new context within each new page, which allows you to handle each page its cookies and application data. This approach allows you to pass the context options as ",(0,r.jsx)(n.code,{children:"pageOptions"})," because a new context is created once you create a new page. In this case, the ",(0,r.jsx)(n.code,{children:"pageOptions"})," corresponds to these ",(0,r.jsx)(n.a,{href:"https://playwright.dev/docs/api/class-browser#browsernewpageoptions",children:"playwright options"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Changing context options with ",(0,r.jsx)(n.code,{children:"LaunchContext"}),":"]})}),"\n",(0,r.jsxs)(n.p,{children:["This will only work if you keep the default value for ",(0,r.jsx)(n.code,{children:"useIncognitoPages"})," (",(0,r.jsx)(n.code,{children:"false"}),")."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const browserPool = new BrowserPool({\n    browserPlugins: [\n        new PlaywrightPlugin(\n            playwright.chromium,\n            {\n                launchOptions: {\n                    deviceScaleFactor: 2,\n                },\n            },\n        ),\n    ],\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Changing context options with ",(0,r.jsx)(n.code,{children:"browserPool.newPage"})," options:"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const browserPool = new BrowserPool({\n     browserPlugins: [\n        new PlaywrightPlugin(\n            playwright.chromium,\n            {\n                useIncognitoPages: true, // You must turn on incognito pages.\n                launchOptions: {\n                    // launch options\n                    headless: false,\n                    devtools: true,\n                },\n            },\n        ),\n    ],\n});\n\n// Launches Chromium with Playwright and returns a Playwright Page.\nconst page = await browserPool.newPage({\n    pageOptions: {\n        // context options\n        deviceScaleFactor: 2,\n        colorScheme: 'light',\n        locale: 'de-DE',\n    },\n});\n\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Changing context options with ",(0,r.jsx)(n.code,{children:"prePageCreateHooks"})," options:"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const browserPool = new BrowserPool({\n    browserPlugins: [\n        new PlaywrightPlugin(\n            playwright.chromium,\n            {\n                useIncognitoPages: true,\n                launchOptions: {\n                // launch options\n                    headless: false,\n                    devtools: true,\n                },\n            },\n        ),\n    ],\n    prePageCreateHooks: [\n        (pageId, browserController, pageOptions) => {\n            pageOptions.deviceScaleFactor = 2;\n            pageOptions.colorScheme = 'dark';\n            pageOptions.locale = 'de-DE';\n\n            // You must modify the 'pageOptions' object, not assign to the variable.\n            // pageOptions = {deviceScaleFactor: 2, ...etc} => This will not work!\n        },\n    ],\n});\n\n// Launches Chromium with Playwright and returns a Playwright Page.\nconst page = await browserPool.newPage();\n"})}),"\n",(0,r.jsx)(n.h3,{id:"single-api-for-common-operations",children:"Single API for common operations"}),"\n",(0,r.jsx)(n.p,{children:"Puppeteer and Playwright handle some things differently. Browser Pool attempts to remove those differences for the most common use-cases."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Playwright\nconst cookies = await context.cookies();\nawait context.addCookies(cookies);\n\n// Puppeteer\nconst cookies = await page.cookies();\nawait page.setCookie(...cookies);\n\n// BrowserPool uses the same API for all plugins\nconst cookies = await browserController.getCookies(page);\nawait browserController.setCookies(page, cookies);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"graceful-browser-closing",children:"Graceful browser closing"}),"\n",(0,r.jsx)(n.p,{children:"With Browser Pool, browsers are not closed, but retired. A retired browser will no longer open new pages, but it will wait until the open pages are closed, allowing your running tasks to finish. If a browser gets stuck in limbo, it will be killed after a timeout to prevent hanging browser processes."}),"\n",(0,r.jsx)(n.h3,{id:"changing-browser-fingerprints-aka-browser-signatures",children:"Changing browser fingerprints a.k.a. browser signatures"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Fingerprints are enabled by default since v3."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Changing browser fingerprints is beneficial for avoiding getting blocked and simulating real user browsers. With Browser Pool, you can do this otherwise complicated technique by enabling the ",(0,r.jsx)(n.code,{children:"useFingerprints"})," option. The fingerprints are by default tied to the respective proxy urls to not use the same unique fingerprint from various IP addresses. You can disable this behavior in the ",(0,r.jsx)(n.a,{href:"/api/browser-pool/interface/FingerprintOptions",children:(0,r.jsx)(n.code,{children:"fingerprintOptions"})}),". In the ",(0,r.jsx)(n.code,{children:"fingerprintOptions"}),", You can also control which fingerprints are generated. You can control parameters as browser, operating system, and browser versions."]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},50065:function(e,n,o){o.d(n,{Z:function(){return i},a:function(){return a}});var r=o(67294);let s={},t=r.createContext(s);function a(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);